# 散列技术简介

定义：集合元素以一种“分散”的方式零散的存放在顺序表中

## 基本概念

* 散列函数：集合元素的关键字（key）与其存储位置（Loc）之间的关系函数，散列函数计算出的值也称为散列值

* Loc(key)：表示关键字值为key的集合元素的存储地址

* 散列表(h)：用散列函数建立起来的表，用于存储集合元素

* 散列：利用散列函数在元素的存储位置和关键字之间建立一种对应关系，将关键字值映射到表中的某个位置，即

  $$Loc(key)=h(key)$$ 

  示例：

  $h(key)=(key+5)%10$

## 特点

* 不需要进行比较即可找到元素位置
* 集合元素在散列表中“松散地排布”

## 冲突

$key1\neq key2$，但$h(key1)=h(key2)$的现象

# 常见散列函数

## 什么是好的散列函数

* 确定性：同一值总被映射到同一地址
* 快速：最好是$O(1)$
* 满射：尽可能充分覆盖整个散列表存储空间
* 均分布：为了充分利用散列空间和降低冲突，要使映射到各个位置的概率接近，避免很多元素扎堆聚集的现象

## 除留余数法

$h(key)=key%M(M为散列表表长)$   模值取不超过M的素数P会更好

### 不足

* 存在不动点$h(0)=0$，与均分布相悖
* 相邻的关键字散列到相邻地址上

## 除留余数法改进MAD

$h(key)=(key*a+b)%P$

* b 作为偏移量，消除了不动点
* a 作为间隔量，原本相邻地址变成间隔为 a

## 平方取中法

$h(key)=(key)^2$的中间若干位k，k应满足：$10^{k-1}<n<10^k$(n为集合中元素个数)

## 折叠法

### 步骤

1. 把关键字值自左向右，分成位数相等的几部分；每部分位数与散列表地址位数相同，最后一部分的位数可以短些
2. 把这些部分的数据叠加起来，得到该关键字的散列地址

### 移位法

### 分解法

## 数字分析法

分析关键字编码组合规律，取分布均匀的若干位

# 冲突处理技术

## 开散列法与闭散列法

* 相同点：
  * 都具有一个散列表和至少一个散列函数
  * 对散列函数的要求一致：均分布、计算快速等
* 开散列法将集合元素存储在散列表**主表之外**
* 闭散列表将集合元素存储在散列表**主表之内**

## 拉链法（开散列法）

查找、插入、删除的平均时间复杂度均为：$O(n/M)$  ($n/M$表示集合元素个数与散列表长的比例，也称为散列表的装填因子)

### 实现步骤

1. 所有关键字互为同义词的集合元素存储在同一个单链表上
2. 所有单链表的头指针存入一个长度为M的散列表中
3. 单链表的头指针在散列表中的存储位置通过散列函数计算得到

![image-20221128213948742](C:\Users\Monty _L\AppData\Roaming\Typora\typora-user-images\image-20221128213948742.png)

### 集合元素的查找操作

1. 计算散列值$h(key)$
2. 到散列表$h(key)$位置处取出单链表头指针
3. 遍历链表进行查找：比较$key$

### 集合元素的插入操作

1. 执行元素查找操作
2. 查找不成功，创建新结点
3. 执行单链表结点插入操作

### 优点

* 拉链法处理冲突简单，且无聚集现象，因此平均查找长度较短
* 由于拉链法中各链表上的结点空间是动态申请的，故它更适合于造表前无法确定表长的情况

### 缺点

* 指针需要额外的存储空间，当数据元素占空间较小时，空间使用率低

## 线性探查法（闭）

缺点：导致线性聚集

所使用的探查序列如下：

$h(key),h(key)+1,h(key)+2，...M-1,0,1,...,h(key)-1$

### 搜索失败

* 遇到一个空位置
* 探查到$h(key)$前一个位置（表满）

### 删除操作

#### 要求：

* 不能简单清除元素，否则会隔离探查序列后面的元素，影响搜索
* 删除元素后，空出的位置能够重复使用

#### 解决方法

1. 为每个位置增加标志域 empty，表示该位置是否使用过
2. 删除元素后，不改变标志位，仍为 false ，元素值改为 NeverUsed

## 二次探查法

### 探查序列

| i    |                           |
| ---- | ------------------------- |
| 1    | $h_1(key)=(h(key)+1^2)%M$ |
|      | $h_1(key)=(h(key)-1^2)%M$ |
| 2    | $h_1(key)=(h(key)+2^2)%M$ |
|      | $h_1(key)=(h(key)-2^2)%M$ |
| ……   | ……                        |

#### 常见错误

* 先减后加
* 漏掉基地址
* 取模计算错误

## 双散列法

具备两个散列函数$h_1$和$h_2$，探查序列为：$(h_1(key)+i*h_2(key))\%M$

### $h_2$的作用

* 对$h_1$散列值产生的一个固定增量，实现跳跃式探查
* 改善“二次聚集”，对两个散列函数都为同义词的关键字很少

**$h_2(key)$应该是小于M且于M互质的整数，以保证探测序列能够最多经过M次探测即可遍历表中的所有地址**

若M为素数，即可取$h_2(key)=key\%(M-2)+1$

### 常见错误

* 将$h_2$散列值列入探查序列
* **$h_2$用来偏移量**











